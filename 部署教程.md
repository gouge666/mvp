# åˆ†å¸ƒå¼ Python é¡¹ç›®ç®¡ç†ä¸æ‰§è¡Œå¹³å° - å®Œæ•´éƒ¨ç½²æ•™ç¨‹

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [æœåŠ¡å™¨è§’è‰²è¯´æ˜](#æœåŠ¡å™¨è§’è‰²è¯´æ˜)
- [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
- [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
- [éªŒè¯ä¸æµ‹è¯•](#éªŒè¯ä¸æµ‹è¯•)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [ç»´æŠ¤ä¸ç®¡ç†](#ç»´æŠ¤ä¸ç®¡ç†)

---

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Flask + Paramiko** çš„åˆ†å¸ƒå¼å¤šæœåŠ¡å™¨ååŒç³»ç»Ÿï¼Œç”¨äºåœ¨å†…ç½‘ç¯å¢ƒä¸­å®ç°ï¼š

- âœ… **å¤šç”¨æˆ·ã€å¤šé¡¹ç›®**çš„ç»Ÿä¸€ç®¡ç†
- âœ… **è™šæ‹Ÿç¯å¢ƒ**çš„é›†ä¸­åˆ›å»ºä¸ç®¡ç†
- âœ… **è·¨æœºå™¨é¡¹ç›®åŒæ­¥**ä¸ç®—æ³•æ‰§è¡Œ
- âœ… **æ‰§è¡Œæ—¥å¿—ä¸ç»“æœ**çš„é›†ä¸­å½’æ¡£
- âœ… **æœ¬åœ° PyPI é•œåƒ**åŠ é€Ÿä¾èµ–å®‰è£…

æ•´ä¸ªç³»ç»Ÿé€šè¿‡ `server103` æä¾›çš„ Web ç•Œé¢è¿›è¡Œç»Ÿä¸€æ“ä½œå’Œè°ƒåº¦ã€‚

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ· Web ç•Œé¢                              â”‚
â”‚              http://192.168.10.3:5003/test                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      Server103 (è°ƒåº¦ä¸­å¿ƒ)           â”‚
           â”‚    192.168.10.3:5003                â”‚
           â”‚  - Web ç®¡ç†ç•Œé¢                      â”‚
           â”‚  - è·¨æœåŠ¡å™¨è°ƒåº¦                      â”‚
           â”‚  - ç»Ÿä¸€ API å…¥å£                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚        â”‚        â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server101â”‚      â”‚  Server102   â”‚      â”‚ Server104â”‚
â”‚ é¡¹ç›®æº   â”‚      â”‚  æ‰§è¡Œç¯å¢ƒ    â”‚      â”‚ ç»“æœå½’æ¡£ â”‚
â”‚ :5001    â”‚      â”‚  :5002       â”‚      â”‚ :5004    â”‚
â”‚          â”‚      â”‚  + PyPIé•œåƒ  â”‚      â”‚          â”‚
â”‚          â”‚      â”‚  :8087       â”‚      â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœåŠ¡å™¨è§’è‰²è¯´æ˜

### ğŸ–¥ï¸ Server101 (192.168.10.1:5001) - é¡¹ç›®æºæœåŠ¡å™¨

**èŒè´£**ï¼šå­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„é¡¹ç›®æºä»£ç å’Œæ•°æ®é›†

**ç›®å½•ç»“æ„**ï¼š
```
/home/user/{username}/projects/{projectname}/
  â”œâ”€â”€ æºä»£ç æ–‡ä»¶ (å¦‚ main.py)
  â”œâ”€â”€ æ•°æ®é›† (å¯é€‰)
  â””â”€â”€ requirements.txt (æ¨è)
```

**ç‰¹ç‚¹**ï¼š
- å”¯ä¸€æƒå¨çš„é¡¹ç›®æº
- æ‰€æœ‰æ‰§è¡Œå‰çš„é¡¹ç›®éƒ½ä»è¿™é‡ŒåŒæ­¥
- æä¾›åŸºç¡€æ–‡ä»¶ä¼ è¾“ API


### ğŸ–¥ï¸ Server102 (192.168.10.2:5002) - ç¯å¢ƒä¸æ‰§è¡ŒæœåŠ¡å™¨

**èŒè´£**ï¼šç®¡ç†è™šæ‹Ÿç¯å¢ƒå¹¶æ‰§è¡Œç®—æ³•ä»»åŠ¡

**ç›®å½•ç»“æ„**ï¼š
```
/home/user/{username}/
  â”œâ”€â”€ envs/{env_name}/          # è™šæ‹Ÿç¯å¢ƒ
  â””â”€â”€ projects/{projectname}/   # ä» Server101 åŒæ­¥çš„é¡¹ç›®å‰¯æœ¬
```

**ç‰¹ç‚¹**ï¼š
- ç®¡ç†æ¯ä¸ªç”¨æˆ·çš„è™šæ‹Ÿç¯å¢ƒ
- å®é™…è¿è¡Œç®—æ³•çš„æ‰§è¡ŒèŠ‚ç‚¹
- æ‰˜ç®¡æœ¬åœ° PyPI é•œåƒæœåŠ¡ (ç«¯å£ 8087)

**PyPI é•œåƒ**ï¼š
- è®¿é—®åœ°å€ï¼š`http://192.168.10.2:8087/simple/`
- åŒ…æ–‡ä»¶ç›®å½•ï¼š`/home/user/common/mypackages/packages/`

---

### ğŸ–¥ï¸ Server103 (192.168.10.3:5003) - Web ç®¡ç†ä¸è°ƒåº¦ä¸­å¿ƒ

**èŒè´£**ï¼šæä¾›ç»Ÿä¸€çš„ Web ç®¡ç†ç•Œé¢å’Œè·¨æœåŠ¡å™¨è°ƒåº¦

**Web ç•Œé¢**ï¼š`http://192.168.10.3:5003/test`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ç”¨æˆ·ç›®å½•åˆå§‹åŒ–
- æ‰«æ Server101 ä¸Šçš„é¡¹ç›®åˆ—è¡¨
- åœ¨ Server102 ä¸Šåˆ›å»º/åˆ—å‡º/åˆ é™¤è™šæ‹Ÿç¯å¢ƒ
- è°ƒåº¦ç®—æ³•æ‰§è¡Œï¼ˆåŒæ­¥/å¼‚æ­¥ï¼‰
- å°†æ‰§è¡Œç»“æœä¸æ—¥å¿—å½’æ¡£åˆ° Server104

---

### ğŸ–¥ï¸ Server104 (192.168.10.4:5004) - ç»“æœä¸è¾“å‡ºæœåŠ¡å™¨

**èŒè´£**ï¼šé›†ä¸­å­˜æ”¾æ‰§è¡Œç»“æœä¸æ—¥å¿—

**ç›®å½•ç»“æ„**ï¼š
```
/home/user/{username}/outputs/{projectname}/
  â”œâ”€â”€ run_20260115_143025.log              # æ‰§è¡Œæ—¥å¿—
  â””â”€â”€ run_20260115_143025/                 # å®Œæ•´é¡¹ç›®æ‹·è´
      â”œâ”€â”€ main.py
      â”œâ”€â”€ output/
      â””â”€â”€ ...
```

**ç‰¹ç‚¹**ï¼š
- æŒ‰ç”¨æˆ·ã€æŒ‰é¡¹ç›®ç»„ç»‡è¾“å‡º
- æ¯æ¬¡æ‰§è¡Œç”Ÿæˆç‹¬ç«‹çš„æ—¶é—´æˆ³ç›®å½•
- æä¾›æ—¥å¿—æŸ¥è¯¢ API


---

## å‰ç½®å‡†å¤‡

### 1. ç¡¬ä»¶ä¸ç½‘ç»œè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| æœåŠ¡å™¨æ•°é‡ | 4 å° (å¯ä»¥æ˜¯è™šæ‹Ÿæœº) |
| æ“ä½œç³»ç»Ÿ | Linux (æ¨è Ubuntu 18.04+) |
| ç½‘ç»œ | å†…ç½‘äº’é€šï¼ŒSSH ç«¯å£ 22 å¼€æ”¾ |
| Python ç‰ˆæœ¬ | Python 3.6+ |
| ç£ç›˜ç©ºé—´ | æ¯å°è‡³å°‘ 20GB å¯ç”¨ç©ºé—´ |

### 2. æœåŠ¡å™¨ IP ä¸ç«¯å£è§„åˆ’

| æœåŠ¡å™¨ | IP åœ°å€ | SSH ç«¯å£ | æœåŠ¡ç«¯å£ | é¢å¤–ç«¯å£ |
|--------|---------|----------|----------|----------|
| Server101 | 192.168.10.1 | 22 | 5001 | - |
| Server102 | 192.168.10.2 | 22 | 5002 | 8087 (PyPI) |
| Server103 | 192.168.10.3 | 22 | 5003 | - |
| Server104 | 192.168.10.4 | 22 | 5004 | - |

### 3. SSH è´¦å·ç»Ÿä¸€é…ç½®

**æ‰€æœ‰æœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„è´¦å·ä¿¡æ¯**ï¼š

```bash
SSH ç”¨æˆ·åï¼šuser
SSH å¯†ç ï¼š1234567
SSH ç«¯å£ï¼š22
Sudo å¯†ç ï¼š1234567
```

âš ï¸ **å®‰å…¨æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ SSH å¯†é’¥è®¤è¯ï¼Œé¿å…æ˜æ–‡å¯†ç ã€‚

### 4. è½¯ä»¶ä¾èµ–

åœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šå®‰è£…ï¼š

```bash
# æ›´æ–°åŒ…ç®¡ç†å™¨
sudo apt update

# å®‰è£… Python3 å’Œ pip
sudo apt install -y python3 python3-pip python3-venv

# å®‰è£…ç³»ç»Ÿä¾èµ–
sudo apt install -y build-essential libssl-dev libffi-dev
```


---

## éƒ¨ç½²æ­¥éª¤

### é˜¶æ®µä¸€ï¼šå‡†å¤‡éƒ¨ç½²ç¯å¢ƒ (åœ¨ Server103 ä¸Šæ“ä½œ)

#### æ­¥éª¤ 1ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

å°†æ•´ä¸ªé¡¹ç›®ä¸Šä¼ åˆ° Server103 çš„éƒ¨ç½²ç›®å½•ï¼š

```bash
# åœ¨ Server103 ä¸Šåˆ›å»ºéƒ¨ç½²ç›®å½•
ssh user@192.168.10.3
mkdir -p /home/user/common/localpythonmvp
cd /home/user/common/localpythonmvp

# ä»æœ¬åœ°ä¸Šä¼ é¡¹ç›®ï¼ˆåœ¨æœ¬åœ°æœºå™¨æ‰§è¡Œï¼‰
scp -r /path/to/project/* user@192.168.10.3:/home/user/common/localpythonmvp/
```

#### æ­¥éª¤ 2ï¼šé…ç½® SSH å…å¯†ç™»å½•ï¼ˆæ¨èï¼‰

ä¸ºäº†æ–¹ä¾¿åç»­çš„ `scp` åˆ†å‘ï¼Œå»ºè®®é…ç½® SSH å…å¯†ç™»å½•ï¼š

```bash
# åœ¨ Server103 ä¸Šç”Ÿæˆ SSH å¯†é’¥
ssh-keygen -t rsa -b 4096 -N "" -f ~/.ssh/id_rsa

# å°†å…¬é’¥å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨
ssh-copy-id user@192.168.10.1
ssh-copy-id user@192.168.10.2
ssh-copy-id user@192.168.10.4

# æµ‹è¯•å…å¯†ç™»å½•
ssh user@192.168.10.1 "echo 'SSH è¿æ¥æˆåŠŸ'"
```

å¦‚æœæ— æ³•é…ç½®å…å¯†ç™»å½•ï¼Œåç»­ `scp` å‘½ä»¤ä¼šæç¤ºè¾“å…¥å¯†ç ã€‚

---

### é˜¶æ®µäºŒï¼šéƒ¨ç½² PyPI é•œåƒæœåŠ¡ (åœ¨ Server102 ä¸Š)

#### æ­¥éª¤ 3ï¼šå‡†å¤‡ mypackages è™šæ‹Ÿç¯å¢ƒ

**åœ¨ Server103 ä¸Šæ“ä½œ**ï¼š

```bash
cd /home/user/common/localpythonmvp/mypackages

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£… pypiserver
pip install --upgrade pip
pip install pypiserver

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```


#### æ­¥éª¤ 4ï¼šåˆ†å‘ mypackages åˆ° Server102

```bash
# åœ¨ Server103 ä¸Šæ‰§è¡Œ
cd /home/user/common/localpythonmvp

# åœ¨ Server102 ä¸Šåˆ›å»ºç›®æ ‡ç›®å½•
ssh user@192.168.10.2 "mkdir -p /home/user/common"

# å¤åˆ¶ mypackages ç›®å½•ï¼ˆåŒ…å« venvï¼‰
scp -r mypackages user@192.168.10.2:/home/user/common/
```

#### æ­¥éª¤ 5ï¼šå¯åŠ¨ PyPI é•œåƒæœåŠ¡

**åœ¨ Server102 ä¸Šæ“ä½œ**ï¼š

```bash
# ç™»å½• Server102
ssh user@192.168.10.2

# è¿›å…¥ mypackages ç›®å½•
cd /home/user/common/mypackages

# èµ‹äºˆå¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# åå°å¯åŠ¨ PyPI æœåŠ¡
nohup bash ./deploy.sh > deploy_run.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
tail -f deploy_run.log
# çœ‹åˆ°ç±»ä¼¼ "Serving on http://0.0.0.0:8087" è¡¨ç¤ºæˆåŠŸ
```

#### æ­¥éª¤ 6ï¼šéªŒè¯ PyPI é•œåƒæœåŠ¡

```bash
# åœ¨ä»»æ„æœåŠ¡å™¨ä¸Šæµ‹è¯•è®¿é—®
curl http://192.168.10.2:8087/simple/

# åº”è¯¥è¿”å› HTML é¡µé¢ï¼Œåˆ—å‡ºå¯ç”¨çš„åŒ…
```

---

### é˜¶æ®µä¸‰ï¼šå‡†å¤‡åŸºçº¿è™šæ‹Ÿç¯å¢ƒ (åœ¨ Server102 ä¸Š)

#### æ­¥éª¤ 7ï¼šåˆ›å»º basevenv

**åœ¨ Server103 ä¸Šæ“ä½œ**ï¼š

```bash
cd /home/user/common/localpythonmvp

# åˆ›å»º basevenv ç›®å½•
mkdir -p basevenv

# åˆ›å»ºåŸºçº¿è™šæ‹Ÿç¯å¢ƒ
python3 -m venv basevenv/venv
```


#### æ­¥éª¤ 8ï¼šåˆ†å‘ basevenv åˆ° Server102

```bash
# åœ¨ Server103 ä¸Šæ‰§è¡Œ
cd /home/user/common/localpythonmvp

# å¤åˆ¶ basevenv åˆ° Server102
scp -r basevenv user@192.168.10.2:/home/user/common/
```

**è¯´æ˜**ï¼š`basevenv` æ˜¯ä¸€ä¸ªåŸºç¡€è™šæ‹Ÿç¯å¢ƒæ¨¡æ¿ï¼ŒServer102 åœ¨ä¸ºç”¨æˆ·åˆ›å»ºæ–°ç¯å¢ƒæ—¶ä¼šå¿«é€Ÿæ‹·è´è¿™ä¸ªæ¨¡æ¿ï¼Œé¿å…æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºã€‚

---

### é˜¶æ®µå››ï¼šéƒ¨ç½²å„æœåŠ¡å™¨çš„ Flask åº”ç”¨

#### æ­¥éª¤ 9ï¼šä¸ºæ¯ä¸ª server å‡†å¤‡è™šæ‹Ÿç¯å¢ƒ

**åœ¨ Server103 ä¸Šæ“ä½œ**ï¼š

```bash
cd /home/user/common/localpythonmvp

# ä¸º server101 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd server101
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt \
  --index-url http://192.168.10.2:8087/simple/ \
  --trusted-host 192.168.10.2
deactivate
cd ..

# ä¸º server102 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd server102
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt \
  --index-url http://192.168.10.2:8087/simple/ \
  --trusted-host 192.168.10.2
deactivate
cd ..

# ä¸º server103 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd server103
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt \
  --index-url http://192.168.10.2:8087/simple/ \
  --trusted-host 192.168.10.2
deactivate
cd ..

# ä¸º server104 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd server104
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt \
  --index-url http://192.168.10.2:8087/simple/ \
  --trusted-host 192.168.10.2
deactivate
cd ..
```


#### æ­¥éª¤ 10ï¼šåˆ†å‘å„ server åˆ°å¯¹åº”æœåŠ¡å™¨

**åœ¨ Server103 ä¸Šæ‰§è¡Œ**ï¼š

```bash
cd /home/user/common/localpythonmvp

# åœ¨å„æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®æ ‡ç›®å½•
ssh user@192.168.10.1 "mkdir -p /home/user/common"
ssh user@192.168.10.2 "mkdir -p /home/user/common"
ssh user@192.168.10.4 "mkdir -p /home/user/common"

# åˆ†å‘ server101 åˆ° Server101
scp -r server101 user@192.168.10.1:/home/user/common/

# åˆ†å‘ server102 åˆ° Server102
scp -r server102 user@192.168.10.2:/home/user/common/

# server103 å·²ç»åœ¨æœ¬æœºï¼Œæ— éœ€åˆ†å‘ï¼ˆæˆ–å¤åˆ¶åˆ°æ­£å¼ç›®å½•ï¼‰
# å¦‚æœéœ€è¦ï¼Œå¯ä»¥æ‰§è¡Œï¼š
# cp -r server103 /home/user/common/

# åˆ†å‘ server104 åˆ° Server104
scp -r server104 user@192.168.10.4:/home/user/common/
```

---

### é˜¶æ®µäº”ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡

#### æ­¥éª¤ 11ï¼šå¯åŠ¨ Server101

```bash
# ç™»å½• Server101
ssh user@192.168.10.1

# è¿›å…¥ server101 ç›®å½•
cd /home/user/common/server101

# èµ‹äºˆå¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# åå°å¯åŠ¨æœåŠ¡
sudo nohup bash ./start.sh > start.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f start.log
# çœ‹åˆ° "Running on http://0.0.0.0:5001" è¡¨ç¤ºæˆåŠŸ
```

#### æ­¥éª¤ 12ï¼šå¯åŠ¨ Server102

```bash
# ç™»å½• Server102
ssh user@192.168.10.2

# è¿›å…¥ server102 ç›®å½•
cd /home/user/common/server102

# èµ‹äºˆå¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# åå°å¯åŠ¨æœåŠ¡
sudo nohup bash ./start.sh > start.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f start.log
```


#### æ­¥éª¤ 13ï¼šå¯åŠ¨ Server103

```bash
# åœ¨ Server103 ä¸Šæ“ä½œï¼ˆæœ¬æœºï¼‰
cd /home/user/common/localpythonmvp/server103

# èµ‹äºˆå¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# åå°å¯åŠ¨æœåŠ¡
sudo nohup bash ./start.sh > start.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f start.log
# çœ‹åˆ° "Running on http://0.0.0.0:5003" è¡¨ç¤ºæˆåŠŸ
```

#### æ­¥éª¤ 14ï¼šå¯åŠ¨ Server104

```bash
# ç™»å½• Server104
ssh user@192.168.10.4

# è¿›å…¥ server104 ç›®å½•
cd /home/user/common/server104

# èµ‹äºˆå¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# åå°å¯åŠ¨æœåŠ¡
sudo nohup bash ./start.sh > start.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f start.log
```

---

## éªŒè¯ä¸æµ‹è¯•

### 1. æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€

åœ¨ä»»æ„æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# æ£€æŸ¥ Server101
curl http://192.168.10.1:5001/health

# æ£€æŸ¥ Server102
curl http://192.168.10.2:5002/health

# æ£€æŸ¥ Server103
curl http://192.168.10.3:5003/health

# æ£€æŸ¥ Server104
curl http://192.168.10.4:5004/health

# æ£€æŸ¥ PyPI é•œåƒ
curl http://192.168.10.2:8087/simple/
```

æ‰€æœ‰æœåŠ¡åº”è¯¥è¿”å›æ­£å¸¸çš„ JSON å“åº”æˆ– HTML é¡µé¢ã€‚


### 2. è®¿é—® Web ç®¡ç†ç•Œé¢

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š

```
http://192.168.10.3:5003/test
```

åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ç®¡ç†ç•Œé¢ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½åŒºï¼š

- ğŸ‘¤ ç”¨æˆ·åˆå§‹åŒ–
- ğŸ“ æ–‡ä»¶ç®¡ç†
- ğŸ è™šæ‹Ÿç¯å¢ƒç®¡ç†
- ğŸš€ é¡¹ç›®æ‰§è¡Œ
- ğŸ“Š æ—¥å¿—æŸ¥çœ‹

### 3. å®Œæ•´åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯• 1ï¼šåˆå§‹åŒ–ç”¨æˆ·ç›®å½•

1. åœ¨ Web ç•Œé¢çš„"ç”¨æˆ·åˆå§‹åŒ–"åŒºåŸŸ
2. è¾“å…¥ç”¨æˆ·åï¼š`testuser`
3. ç‚¹å‡»"åˆ›å»ºç”¨æˆ·åŸºç¡€ç›®å½•"
4. åº”è¯¥çœ‹åˆ°æˆåŠŸæ¶ˆæ¯ï¼Œè¡¨ç¤ºåœ¨å››å°æœåŠ¡å™¨ä¸Šéƒ½åˆ›å»ºäº†ç›®å½•

#### æµ‹è¯• 2ï¼šä¸Šä¼ æµ‹è¯•é¡¹ç›®

**åœ¨ Server101 ä¸Šæ‰‹åŠ¨åˆ›å»ºæµ‹è¯•é¡¹ç›®**ï¼š

```bash
# ç™»å½• Server101
ssh user@192.168.10.1

# åˆ›å»ºæµ‹è¯•é¡¹ç›®ç›®å½•
mkdir -p /home/user/testuser/projects/test_algorithm

# å¤åˆ¶ç¤ºä¾‹é¡¹ç›®
cd /home/user/common/localpythonmvp
cp -r test_algorithm/* /home/user/testuser/projects/test_algorithm/

# åˆ›å»ºå¿…è¦çš„å­ç›®å½•
mkdir -p /home/user/testuser/projects/test_algorithm/output
mkdir -p /home/user/testuser/projects/test_algorithm/dataset

# ç¡®ä¿æƒé™æ­£ç¡®
chmod -R 755 /home/user/testuser/projects/test_algorithm
```


#### æµ‹è¯• 3ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

1. åœ¨ Web ç•Œé¢çš„"è™šæ‹Ÿç¯å¢ƒç®¡ç†"åŒºåŸŸ
2. è¾“å…¥ï¼š
   - ç”¨æˆ·åï¼š`testuser`
   - ç¯å¢ƒåç§°ï¼š`testenv`
3. ç‚¹å‡»"åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"
4. ç­‰å¾…åˆ›å»ºå®Œæˆï¼ˆé€šå¸¸å‡ ç§’é’Ÿï¼‰

#### æµ‹è¯• 4ï¼šæ‰§è¡Œç®—æ³•

1. åœ¨ Web ç•Œé¢çš„"é¡¹ç›®æ‰§è¡Œ"åŒºåŸŸ
2. è¾“å…¥ï¼š
   - ç”¨æˆ·åï¼š`testuser`
   - é¡¹ç›®åç§°ï¼š`test_algorithm`
   - è™šæ‹Ÿç¯å¢ƒï¼š`testenv`
   - æ‰§è¡Œå‘½ä»¤ï¼š`python concat_img.py`
3. é€‰æ‹©æ‰§è¡Œæ¨¡å¼ï¼ˆåŒæ­¥æˆ–å¼‚æ­¥ï¼‰
4. ç‚¹å‡»"æ‰§è¡Œé¡¹ç›®"
5. æŸ¥çœ‹æ‰§è¡Œç»“æœå’Œæ—¥å¿—

#### æµ‹è¯• 5ï¼šæŸ¥çœ‹æ‰§è¡Œç»“æœ

**æ–¹å¼ä¸€ï¼šé€šè¿‡ Web ç•Œé¢**

1. åœ¨"æ—¥å¿—æŸ¥çœ‹"åŒºåŸŸ
2. è¾“å…¥ç”¨æˆ·åå’Œé¡¹ç›®åç§°
3. ç‚¹å‡»"è·å–æ—¥å¿—"

**æ–¹å¼äºŒï¼šç›´æ¥åœ¨ Server104 ä¸ŠæŸ¥çœ‹**

```bash
# ç™»å½• Server104
ssh user@192.168.10.4

# æŸ¥çœ‹è¾“å‡ºç›®å½•
ls -la /home/user/testuser/outputs/test_algorithm/

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
cat /home/user/testuser/outputs/test_algorithm/run_*.log | tail -50

# æŸ¥çœ‹å®Œæ•´é¡¹ç›®è¾“å‡º
ls -la /home/user/testuser/outputs/test_algorithm/run_*/
```

---

## ä½¿ç”¨æŒ‡å—

### å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·åˆå§‹åŒ–
   â†“
2. åœ¨ Server101 ä¸Šä¼ é¡¹ç›®ä»£ç 
   â†“
3. åœ¨ Server102 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
   â†“
4. é€šè¿‡ Web ç•Œé¢æ‰§è¡Œé¡¹ç›®
   â†“
5. åœ¨ Server104 æŸ¥çœ‹ç»“æœ
```


### è¯¦ç»†æ“ä½œè¯´æ˜

#### 1. ç”¨æˆ·åˆå§‹åŒ–

**ç›®çš„**ï¼šåœ¨å››å°æœåŠ¡å™¨ä¸Šä¸ºæ–°ç”¨æˆ·åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„

**æ“ä½œæ­¥éª¤**ï¼š
1. è®¿é—® `http://192.168.10.3:5003/test`
2. åœ¨"ğŸ‘¤ ç”¨æˆ·åˆå§‹åŒ–"åŒºåŸŸè¾“å…¥ç”¨æˆ·åï¼ˆå¦‚ `alice`ï¼‰
3. ç‚¹å‡»"åˆ›å»ºç”¨æˆ·åŸºç¡€ç›®å½•"

**åˆ›å»ºçš„ç›®å½•**ï¼š
- Server101: `/home/user/alice/projects/`
- Server102: `/home/user/alice/projects/` å’Œ `/home/user/alice/envs/`
- Server103: `/home/user/alice/projects/`
- Server104: `/home/user/alice/outputs/`

#### 2. ä¸Šä¼ é¡¹ç›®

**æ–¹å¼ä¸€ï¼šé€šè¿‡ SCP ä¸Šä¼ **

```bash
# ä»æœ¬åœ°ä¸Šä¼ åˆ° Server101
scp -r /local/project/path user@192.168.10.1:/home/user/alice/projects/myproject/
```

**æ–¹å¼äºŒï¼šç›´æ¥åœ¨ Server101 ä¸Šåˆ›å»º**

```bash
ssh user@192.168.10.1
mkdir -p /home/user/alice/projects/myproject
cd /home/user/alice/projects/myproject
# ç¼–è¾‘ä»£ç æ–‡ä»¶...
```

**é¡¹ç›®ç»“æ„å»ºè®®**ï¼š

```
myproject/
â”œâ”€â”€ main.py              # ä¸»ç¨‹åº
â”œâ”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨ï¼ˆæ¨èï¼‰
â”œâ”€â”€ data/                # æ•°æ®ç›®å½•ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ output/              # è¾“å‡ºç›®å½•ï¼ˆå¯é€‰ï¼‰
```

#### 3. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

**æ“ä½œæ­¥éª¤**ï¼š
1. åœ¨ Web ç•Œé¢çš„"ğŸ è™šæ‹Ÿç¯å¢ƒç®¡ç†"åŒºåŸŸ
2. è¾“å…¥ç”¨æˆ·åå’Œç¯å¢ƒåç§°
3. ç‚¹å‡»"åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"

**ç¯å¢ƒå‘½åå»ºè®®**ï¼š
- æŒ‰é¡¹ç›®å‘½åï¼š`myproject_env`
- æŒ‰ç”¨é€”å‘½åï¼š`ml_env`, `web_env`
- æŒ‰ç‰ˆæœ¬å‘½åï¼š`py39_env`

**æŸ¥çœ‹å·²æœ‰ç¯å¢ƒ**ï¼š
- ç‚¹å‡»"åˆ—å‡ºè™šæ‹Ÿç¯å¢ƒ"æŒ‰é’®


#### 4. æ‰§è¡Œé¡¹ç›®

**åŒæ­¥æ‰§è¡Œ vs å¼‚æ­¥æ‰§è¡Œ**ï¼š

| æ¨¡å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| åŒæ­¥æ‰§è¡Œ | ç­‰å¾…æ‰§è¡Œå®Œæˆåè¿”å›ç»“æœ | å¿«é€Ÿä»»åŠ¡ï¼ˆ< 5åˆ†é’Ÿï¼‰ |
| å¼‚æ­¥æ‰§è¡Œ | ç«‹å³è¿”å›ï¼Œåå°æ‰§è¡Œ | é•¿æ—¶é—´ä»»åŠ¡ï¼ˆ> 5åˆ†é’Ÿï¼‰ |

**æ‰§è¡Œæµç¨‹**ï¼š

1. **é¡¹ç›®åŒæ­¥**ï¼šä» Server101 å¤åˆ¶åˆ° Server102
2. **ä¾èµ–å®‰è£…**ï¼šå¦‚æœå­˜åœ¨ `requirements.txt`ï¼Œè‡ªåŠ¨å®‰è£…ä¾èµ–
3. **æ‰§è¡Œå‘½ä»¤**ï¼šåœ¨æŒ‡å®šè™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤
4. **ç»“æœå½’æ¡£**ï¼šå°†æ—¥å¿—å’Œå®Œæ•´é¡¹ç›®å¤åˆ¶åˆ° Server104

**å¸¸ç”¨æ‰§è¡Œå‘½ä»¤ç¤ºä¾‹**ï¼š

```bash
# Python è„šæœ¬
python main.py

# å¸¦å‚æ•°çš„è„šæœ¬
python train.py --epochs 100 --batch-size 32

# Jupyter Notebook è½¬æ¢æ‰§è¡Œ
jupyter nbconvert --to notebook --execute notebook.ipynb

# Shell è„šæœ¬
bash run.sh
```

#### 5. æŸ¥çœ‹ç»“æœ

**æ—¥å¿—æ–‡ä»¶å‘½åè§„åˆ™**ï¼š

```
run_YYYYMMDD_HHMMSS.log
```

ä¾‹å¦‚ï¼š`run_20260115_143025.log`

**è¾“å‡ºç›®å½•ç»“æ„**ï¼š

```
/home/user/alice/outputs/myproject/
â”œâ”€â”€ run_20260115_143025.log          # æ‰§è¡Œæ—¥å¿—
â”œâ”€â”€ run_20260115_143025/             # å®Œæ•´é¡¹ç›®å¿«ç…§
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â””â”€â”€ result.txt
â”‚   â””â”€â”€ ...
â””â”€â”€ run_20260115_150130.log          # ä¸‹ä¸€æ¬¡æ‰§è¡Œ
```


---

## å¸¸è§é—®é¢˜

### Q1: æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæç¤ºç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo netstat -tulpn | grep :5003

# æˆ–ä½¿ç”¨ lsof
sudo lsof -i :5003

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>

# é‡æ–°å¯åŠ¨æœåŠ¡
cd /home/user/common/server103
sudo nohup bash ./start.sh > start.log 2>&1 &
```

### Q2: SSH è¿æ¥å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. SSH æœåŠ¡æœªå¯åŠ¨
2. é˜²ç«å¢™é˜»æ­¢
3. è´¦å·å¯†ç é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€
sudo systemctl status ssh

# å¯åŠ¨ SSH æœåŠ¡
sudo systemctl start ssh

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# å…è®¸ SSH ç«¯å£
sudo ufw allow 22
```

### Q3: PyPI é•œåƒæ— æ³•è®¿é—®

**æ£€æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
ssh user@192.168.10.2
ps aux | grep pypi-server

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tulpn | grep :8087

# 3. é‡å¯ PyPI æœåŠ¡
cd /home/user/common/mypackages
pkill -f pypi-server
nohup bash ./deploy.sh > deploy_run.log 2>&1 &

# 4. æµ‹è¯•è®¿é—®
curl http://192.168.10.2:8087/simple/
```


### Q4: é¡¹ç›®æ‰§è¡Œå¤±è´¥

**å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•**ï¼š

**é”™è¯¯ 1ï¼šæ‰¾ä¸åˆ°é¡¹ç›®ç›®å½•**

```
è§£å†³ï¼šç¡®ä¿é¡¹ç›®å·²ä¸Šä¼ åˆ° Server101 çš„æ­£ç¡®è·¯å¾„
è·¯å¾„æ ¼å¼ï¼š/home/user/{username}/projects/{projectname}/
```

**é”™è¯¯ 2ï¼šè™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨**

```
è§£å†³ï¼šå…ˆåœ¨ Web ç•Œé¢åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
æˆ–æ£€æŸ¥ç¯å¢ƒåç§°æ˜¯å¦æ­£ç¡®
```

**é”™è¯¯ 3ï¼šä¾èµ–å®‰è£…å¤±è´¥**

```
è§£å†³ï¼š
1. æ£€æŸ¥ requirements.txt æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ PyPI é•œåƒæœåŠ¡æ­£å¸¸è¿è¡Œ
3. æ‰‹åŠ¨åœ¨ Server102 ä¸Šå®‰è£…ä¾èµ–æµ‹è¯•
```

**é”™è¯¯ 4ï¼šæƒé™ä¸è¶³**

```bash
# åœ¨å¯¹åº”æœåŠ¡å™¨ä¸Šä¿®æ”¹æƒé™
sudo chmod -R 755 /home/user/{username}/
sudo chown -R user:user /home/user/{username}/
```

### Q5: å¦‚ä½•æ·»åŠ æ–°çš„ Python åŒ…åˆ° PyPI é•œåƒ

**æ­¥éª¤**ï¼š

```bash
# 1. ä¸‹è½½åŒ…æ–‡ä»¶ï¼ˆ.whl æˆ– .tar.gzï¼‰
# ä»å®˜æ–¹æºæˆ–æ¸…åæºä¸‹è½½
wget https://pypi.tuna.tsinghua.edu.cn/packages/.../package-1.0.0-py3-none-any.whl

# 2. ä¸Šä¼ åˆ° Server102
scp package-1.0.0-py3-none-any.whl user@192.168.10.2:/home/user/common/mypackages/packages/

# 3. PyPI æœåŠ¡ä¼šè‡ªåŠ¨è¯†åˆ«æ–°åŒ…ï¼Œæ— éœ€é‡å¯
```

### Q6: å¦‚ä½•æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# Server101
ssh user@192.168.10.1
tail -f /home/user/common/server101/start.log

# Server102
ssh user@192.168.10.2
tail -f /home/user/common/server102/start.log

# Server103
tail -f /home/user/common/localpythonmvp/server103/start.log

# Server104
ssh user@192.168.10.4
tail -f /home/user/common/server104/start.log

# PyPI é•œåƒ
ssh user@192.168.10.2
tail -f /home/user/common/mypackages/deploy_run.log
```


### Q7: å¦‚ä½•åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
# åœæ­¢ Server101
ssh user@192.168.10.1
sudo pkill -f "python.*app.py.*5001"

# åœæ­¢ Server102
ssh user@192.168.10.2
sudo pkill -f "python.*app.py.*5002"

# åœæ­¢ Server103
sudo pkill -f "python.*app.py.*5003"

# åœæ­¢ Server104
ssh user@192.168.10.4
sudo pkill -f "python.*app.py.*5004"

# åœæ­¢ PyPI é•œåƒ
ssh user@192.168.10.2
pkill -f pypi-server
```

### Q8: å¦‚ä½•å¤‡ä»½ç”¨æˆ·æ•°æ®

**å¤‡ä»½è„šæœ¬ç¤ºä¾‹**ï¼š

```bash
#!/bin/bash
# backup.sh - å¤‡ä»½ç”¨æˆ·æ•°æ®

BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/user_data_${BACKUP_DATE}"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p ${BACKUP_DIR}

# å¤‡ä»½ Server101 é¡¹ç›®æº
ssh user@192.168.10.1 "tar -czf - /home/user/*/projects/" > ${BACKUP_DIR}/server101_projects.tar.gz

# å¤‡ä»½ Server104 è¾“å‡ºç»“æœ
ssh user@192.168.10.4 "tar -czf - /home/user/*/outputs/" > ${BACKUP_DIR}/server104_outputs.tar.gz

echo "å¤‡ä»½å®Œæˆ: ${BACKUP_DIR}"
```

---

## ç»´æŠ¤ä¸ç®¡ç†

### æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡

#### 1. ç£ç›˜ç©ºé—´ç›‘æ§

```bash
# æ£€æŸ¥å„æœåŠ¡å™¨ç£ç›˜ä½¿ç”¨æƒ…å†µ
for server in 192.168.10.{1..4}; do
  echo "=== Server: $server ==="
  ssh user@$server "df -h | grep -E '(Filesystem|/home)'"
done
```

#### 2. æ¸…ç†æ—§çš„æ‰§è¡Œç»“æœ

```bash
# åœ¨ Server104 ä¸Šæ¸…ç† 30 å¤©å‰çš„è¾“å‡º
ssh user@192.168.10.4
find /home/user/*/outputs/ -type d -name "run_*" -mtime +30 -exec rm -rf {} \;
```


#### 3. å®šæœŸé‡å¯æœåŠ¡

**åˆ›å»ºé‡å¯è„šæœ¬**ï¼š

```bash
#!/bin/bash
# restart_all.sh - é‡å¯æ‰€æœ‰æœåŠ¡

echo "åœæ­¢æ‰€æœ‰æœåŠ¡..."

# åœæ­¢å„æœåŠ¡
ssh user@192.168.10.1 "sudo pkill -f 'python.*app.py.*5001'"
ssh user@192.168.10.2 "sudo pkill -f 'python.*app.py.*5002'"
sudo pkill -f "python.*app.py.*5003"
ssh user@192.168.10.4 "sudo pkill -f 'python.*app.py.*5004'"

sleep 5

echo "å¯åŠ¨æ‰€æœ‰æœåŠ¡..."

# å¯åŠ¨ Server101
ssh user@192.168.10.1 "cd /home/user/common/server101 && sudo nohup bash ./start.sh > start.log 2>&1 &"

# å¯åŠ¨ Server102
ssh user@192.168.10.2 "cd /home/user/common/server102 && sudo nohup bash ./start.sh > start.log 2>&1 &"

# å¯åŠ¨ Server103
cd /home/user/common/localpythonmvp/server103 && sudo nohup bash ./start.sh > start.log 2>&1 &

# å¯åŠ¨ Server104
ssh user@192.168.10.4 "cd /home/user/common/server104 && sudo nohup bash ./start.sh > start.log 2>&1 &"

echo "æ‰€æœ‰æœåŠ¡å·²é‡å¯"
```

#### 4. å¥åº·æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# health_check.sh - æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€

check_service() {
  local host=$1
  local port=$2
  local name=$3
  
  if curl -s -o /dev/null -w "%{http_code}" http://${host}:${port}/health | grep -q "200"; then
    echo "âœ… ${name} (${host}:${port}) - æ­£å¸¸"
  else
    echo "âŒ ${name} (${host}:${port}) - å¼‚å¸¸"
  fi
}

echo "=== æœåŠ¡å¥åº·æ£€æŸ¥ ==="
check_service "192.168.10.1" "5001" "Server101"
check_service "192.168.10.2" "5002" "Server102"
check_service "192.168.10.3" "5003" "Server103"
check_service "192.168.10.4" "5004" "Server104"

# æ£€æŸ¥ PyPI é•œåƒ
if curl -s http://192.168.10.2:8087/simple/ | grep -q "Simple"; then
  echo "âœ… PyPI é•œåƒ (192.168.10.2:8087) - æ­£å¸¸"
else
  echo "âŒ PyPI é•œåƒ (192.168.10.2:8087) - å¼‚å¸¸"
fi
```


### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. è™šæ‹Ÿç¯å¢ƒç¼“å­˜

ä¸ºå¸¸ç”¨çš„ä¾èµ–ç»„åˆé¢„åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ¨¡æ¿ï¼š

```bash
# åœ¨ Server102 ä¸Šåˆ›å»ºå¸¸ç”¨ç¯å¢ƒæ¨¡æ¿
cd /home/user/common/templates

# æœºå™¨å­¦ä¹ ç¯å¢ƒæ¨¡æ¿
python3 -m venv ml_template
source ml_template/bin/activate
pip install numpy pandas scikit-learn matplotlib
deactivate

# Web å¼€å‘ç¯å¢ƒæ¨¡æ¿
python3 -m venv web_template
source web_template/bin/activate
pip install flask django requests
deactivate
```

#### 2. PyPI é•œåƒä¼˜åŒ–

å®šæœŸåŒæ­¥å¸¸ç”¨åŒ…åˆ°æœ¬åœ°é•œåƒï¼š

```bash
# æ‰¹é‡ä¸‹è½½å¸¸ç”¨åŒ…
pip download -d /home/user/common/mypackages/packages/ \
  numpy pandas scikit-learn matplotlib \
  flask django requests pillow
```

#### 3. ç½‘ç»œä¼˜åŒ–

å¦‚æœæœåŠ¡å™¨é—´ä¼ è¾“å¤§æ–‡ä»¶è¾ƒæ…¢ï¼Œè€ƒè™‘ï¼š

- ä½¿ç”¨ `rsync` æ›¿ä»£ `scp` è¿›è¡Œå¢é‡åŒæ­¥
- å¯ç”¨ SSH å‹ç¼©ï¼š`scp -C`
- è°ƒæ•´ SSH é…ç½®æé«˜ä¼ è¾“é€Ÿåº¦

### å®‰å…¨åŠ å›ºå»ºè®®

#### 1. ä½¿ç”¨ SSH å¯†é’¥è®¤è¯

```bash
# ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t ed25519 -C "deploy@localpythonmvp"

# åˆ†å‘å…¬é’¥åˆ°æ‰€æœ‰æœåŠ¡å™¨
for server in 192.168.10.{1..4}; do
  ssh-copy-id user@$server
done

# ä¿®æ”¹ä»£ç ä¸­çš„ SSH è¿æ¥æ–¹å¼ï¼Œç§»é™¤å¯†ç 
```

#### 2. é…ç½®é˜²ç«å¢™

```bash
# åœ¨æ¯å°æœåŠ¡å™¨ä¸Šé…ç½® UFW
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp
sudo ufw allow from 192.168.10.0/24 to any port 5001:5004
sudo ufw allow from 192.168.10.0/24 to any port 8087
sudo ufw enable
```


#### 3. æ—¥å¿—å®¡è®¡

å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•ï¼š

```python
# åœ¨å„ server çš„ app.py ä¸­æ·»åŠ 
import logging
from logging.handlers import RotatingFileHandler

handler = RotatingFileHandler(
    'app.log', 
    maxBytes=10*1024*1024,  # 10MB
    backupCount=5
)
handler.setFormatter(logging.Formatter(
    '%(asctime)s %(levelname)s: %(message)s [in %(pathname)s:%(lineno)d]'
))
app.logger.addHandler(handler)
app.logger.setLevel(logging.INFO)
```

#### 4. ç”¨æˆ·æƒé™éš”ç¦»

ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºç‹¬ç«‹çš„ç³»ç»Ÿè´¦å·ï¼š

```bash
# åˆ›å»ºç”¨æˆ·
sudo useradd -m -s /bin/bash alice
sudo passwd alice

# è®¾ç½®ç›®å½•æƒé™
sudo chown -R alice:alice /home/user/alice/
sudo chmod 700 /home/user/alice/
```

---

## æ‰©å±•åŠŸèƒ½

### 1. æ·»åŠ é‚®ä»¶é€šçŸ¥

å½“ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶å‘é€é‚®ä»¶é€šçŸ¥ï¼š

```python
# åœ¨ server103/app.py ä¸­æ·»åŠ 
import smtplib
from email.mime.text import MIMEText

def send_notification(user_email, project_name, status):
    msg = MIMEText(f'é¡¹ç›® {project_name} æ‰§è¡Œ{status}')
    msg['Subject'] = f'ä»»åŠ¡é€šçŸ¥: {project_name}'
    msg['From'] = 'noreply@localpythonmvp.com'
    msg['To'] = user_email
    
    with smtplib.SMTP('smtp.example.com', 587) as server:
        server.starttls()
        server.login('username', 'password')
        server.send_message(msg)
```

### 2. æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—

ä½¿ç”¨ Celery å®ç°å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼š

```bash
# å®‰è£… Celery å’Œ Redis
pip install celery redis

# å¯åŠ¨ Redis
sudo apt install redis-server
sudo systemctl start redis

# é…ç½® Celery worker
celery -A app.celery worker --loglevel=info
```


### 3. æ·»åŠ  Web ç»ˆç«¯

é›†æˆ xterm.js å®ç°æµè§ˆå™¨å†…çš„ç»ˆç«¯è®¿é—®ï¼š

```html
<!-- åœ¨ templates/test.html ä¸­æ·»åŠ  -->
<div id="terminal"></div>
<script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
<script>
  var term = new Terminal();
  term.open(document.getElementById('terminal'));
  // è¿æ¥åˆ°åç«¯ WebSocket
</script>
```

### 4. æ·»åŠ èµ„æºç›‘æ§

ä½¿ç”¨ psutil ç›‘æ§æœåŠ¡å™¨èµ„æºï¼š

```python
import psutil

@app.route('/monitor', methods=['GET'])
def monitor():
    return jsonify({
        'cpu_percent': psutil.cpu_percent(interval=1),
        'memory_percent': psutil.virtual_memory().percent,
        'disk_percent': psutil.disk_usage('/').percent
    })
```

---

## é™„å½•

### A. ç›®å½•ç»“æ„æ€»è§ˆ

```
é¡¹ç›®éƒ¨ç½²ç»“æ„ï¼š

Server101 (192.168.10.1)
â””â”€â”€ /home/user/
    â”œâ”€â”€ common/
    â”‚   â””â”€â”€ server101/          # Flask åº”ç”¨
    â”‚       â”œâ”€â”€ app.py
    â”‚       â”œâ”€â”€ venv/
    â”‚       â””â”€â”€ start.sh
    â””â”€â”€ {username}/
        â””â”€â”€ projects/
            â””â”€â”€ {projectname}/  # ç”¨æˆ·é¡¹ç›®æº

Server102 (192.168.10.2)
â””â”€â”€ /home/user/
    â”œâ”€â”€ common/
    â”‚   â”œâ”€â”€ server102/          # Flask åº”ç”¨
    â”‚   â”œâ”€â”€ mypackages/         # PyPI é•œåƒ
    â”‚   â”‚   â”œâ”€â”€ packages/
    â”‚   â”‚   â”œâ”€â”€ venv/
    â”‚   â”‚   â””â”€â”€ deploy.sh
    â”‚   â””â”€â”€ basevenv/           # åŸºçº¿è™šæ‹Ÿç¯å¢ƒ
    â”‚       â””â”€â”€ venv/
    â””â”€â”€ {username}/
        â”œâ”€â”€ envs/
        â”‚   â””â”€â”€ {env_name}/     # ç”¨æˆ·è™šæ‹Ÿç¯å¢ƒ
        â””â”€â”€ projects/
            â””â”€â”€ {projectname}/  # æ‰§è¡Œç”¨é¡¹ç›®å‰¯æœ¬

Server103 (192.168.10.3)
â””â”€â”€ /home/user/
    â””â”€â”€ common/
        â””â”€â”€ localpythonmvp/
            â””â”€â”€ server103/      # Flask åº”ç”¨ï¼ˆè°ƒåº¦ä¸­å¿ƒï¼‰
                â”œâ”€â”€ app.py
                â”œâ”€â”€ templates/
                â”‚   â””â”€â”€ test.html
                â”œâ”€â”€ venv/
                â””â”€â”€ start.sh

Server104 (192.168.10.4)
â””â”€â”€ /home/user/
    â”œâ”€â”€ common/
    â”‚   â””â”€â”€ server104/          # Flask åº”ç”¨
    â””â”€â”€ {username}/
        â””â”€â”€ outputs/
            â””â”€â”€ {projectname}/
                â”œâ”€â”€ run_*.log   # æ‰§è¡Œæ—¥å¿—
                â””â”€â”€ run_*/      # å®Œæ•´é¡¹ç›®å¿«ç…§
```


### B. API æ¥å£æ–‡æ¡£

#### Server103 ä¸»è¦ API

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/servers` | GET | è·å–æœåŠ¡å™¨é…ç½® |
| `/user/create` | POST | åˆ›å»ºç”¨æˆ·ç›®å½• |
| `/list` | POST | åˆ—å‡ºè¿œç¨‹ç›®å½• |
| `/file/create` | POST | åˆ›å»ºè¿œç¨‹æ–‡ä»¶ |
| `/env/create` | POST | åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ |
| `/env/list` | POST | åˆ—å‡ºè™šæ‹Ÿç¯å¢ƒ |
| `/env/delete` | POST | åˆ é™¤è™šæ‹Ÿç¯å¢ƒ |
| `/env/execute` | POST | æ‰§è¡Œå‘½ä»¤ |
| `/project/list` | POST | åˆ—å‡ºé¡¹ç›® |
| `/project/execute` | POST | åŒæ­¥æ‰§è¡Œé¡¹ç›® |
| `/project/execute/async` | POST | å¼‚æ­¥æ‰§è¡Œé¡¹ç›® |
| `/project/log` | POST | è·å–é¡¹ç›®æ—¥å¿— |
| `/transfer` | POST | ä¼ è¾“æ–‡ä»¶ |

**ç¤ºä¾‹ï¼šåˆ›å»ºç”¨æˆ·ç›®å½•**

```bash
curl -X POST http://192.168.10.3:5003/user/create \
  -H "Content-Type: application/json" \
  -d '{
    "username": "alice"
  }'
```

**ç¤ºä¾‹ï¼šæ‰§è¡Œé¡¹ç›®**

```bash
curl -X POST http://192.168.10.3:5003/project/execute \
  -H "Content-Type: application/json" \
  -d '{
    "username": "alice",
    "projectname": "myproject",
    "env_name": "myenv",
    "command": "python main.py",
    "server": "server102"
  }'
```

### C. é…ç½®æ–‡ä»¶è¯´æ˜

#### requirements.txt

å„ server çš„ä¾èµ–æ–‡ä»¶ï¼š

```
Flask==3.0.0
Werkzeug==3.0.1
paramiko==3.4.0
```

#### pip.conf

è™šæ‹Ÿç¯å¢ƒçš„ pip é…ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š

```ini
[global]
index-url = http://192.168.10.2:8087/simple/
trusted-host = 192.168.10.2
timeout = 600
```


### D. æ•…éšœæ’æŸ¥æ¸…å•

#### é—®é¢˜ï¼šæ— æ³•è®¿é—® Web ç•Œé¢

```
â–¡ æ£€æŸ¥ Server103 æœåŠ¡æ˜¯å¦è¿è¡Œ
â–¡ æ£€æŸ¥ç«¯å£ 5003 æ˜¯å¦è¢«å ç”¨
â–¡ æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
â–¡ æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦èƒ½ ping é€š 192.168.10.3
â–¡ æŸ¥çœ‹ start.log æ—¥å¿—æ–‡ä»¶
```

#### é—®é¢˜ï¼šé¡¹ç›®æ‰§è¡Œå¤±è´¥

```
â–¡ ç¡®è®¤é¡¹ç›®å·²ä¸Šä¼ åˆ° Server101
â–¡ ç¡®è®¤è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
â–¡ æ£€æŸ¥ requirements.txt æ ¼å¼
â–¡ ç¡®è®¤ PyPI é•œåƒæœåŠ¡æ­£å¸¸
â–¡ æ£€æŸ¥ Server102 ç£ç›˜ç©ºé—´
â–¡ æŸ¥çœ‹ Server103 çš„æ‰§è¡Œæ—¥å¿—
```

#### é—®é¢˜ï¼šSSH è¿æ¥è¶…æ—¶

```
â–¡ æ£€æŸ¥ç›®æ ‡æœåŠ¡å™¨ SSH æœåŠ¡çŠ¶æ€
â–¡ æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼ˆpingï¼‰
â–¡ æ£€æŸ¥ SSH ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ 22ï¼‰
â–¡ æ£€æŸ¥è´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
â–¡ æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ SSH
```

#### é—®é¢˜ï¼šæ–‡ä»¶ä¼ è¾“å¤±è´¥

```
â–¡ æ£€æŸ¥æºè·¯å¾„æ˜¯å¦å­˜åœ¨
â–¡ æ£€æŸ¥ç›®æ ‡è·¯å¾„æƒé™
â–¡ æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
â–¡ æ£€æŸ¥ SFTP è¿æ¥æ˜¯å¦æ­£å¸¸
â–¡ å°è¯•æ‰‹åŠ¨ scp æµ‹è¯•
```

### E. å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# === æœåŠ¡ç®¡ç† ===
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
bash restart_all.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
for server in 192.168.10.{1..4}; do
  ssh user@$server "sudo pkill -f 'python.*app.py'"
done

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
bash health_check.sh

# === æ—¥å¿—æŸ¥çœ‹ ===
# å®æ—¶æŸ¥çœ‹ Server103 æ—¥å¿—
tail -f /home/user/common/localpythonmvp/server103/start.log

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
tail -100 /home/user/common/localpythonmvp/server103/start.log

# === ç”¨æˆ·ç®¡ç† ===
# åˆ›å»ºæ–°ç”¨æˆ·ç›®å½•
curl -X POST http://192.168.10.3:5003/user/create \
  -H "Content-Type: application/json" \
  -d '{"username": "newuser"}'

# === ç¯å¢ƒç®¡ç† ===
# åˆ—å‡ºç”¨æˆ·çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒ
ssh user@192.168.10.2 "ls -la /home/user/alice/envs/"

# åˆ é™¤è™šæ‹Ÿç¯å¢ƒ
ssh user@192.168.10.2 "rm -rf /home/user/alice/envs/old_env"

# === é¡¹ç›®ç®¡ç† ===
# ä¸Šä¼ é¡¹ç›®åˆ° Server101
scp -r ./myproject user@192.168.10.1:/home/user/alice/projects/

# æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨
ssh user@192.168.10.1 "ls -la /home/user/alice/projects/"

# === ç»“æœæŸ¥çœ‹ ===
# æŸ¥çœ‹æœ€æ–°æ‰§è¡Œæ—¥å¿—
ssh user@192.168.10.4 "ls -lt /home/user/alice/outputs/myproject/*.log | head -1"

# ä¸‹è½½æ‰§è¡Œç»“æœ
scp -r user@192.168.10.4:/home/user/alice/outputs/myproject/run_*/ ./results/
```


### F. æ€§èƒ½å‚è€ƒæŒ‡æ ‡

| æ“ä½œ | é¢„æœŸæ—¶é—´ | è¯´æ˜ |
|------|----------|------|
| åˆ›å»ºç”¨æˆ·ç›®å½• | < 5 ç§’ | åœ¨ 4 å°æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½• |
| åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ | 5-30 ç§’ | å–å†³äºåŸºçº¿ç¯å¢ƒå¤§å° |
| é¡¹ç›®åŒæ­¥ (100MB) | 10-30 ç§’ | Server101 â†’ Server102 |
| ä¾èµ–å®‰è£… (10ä¸ªåŒ…) | 30-120 ç§’ | ä½¿ç”¨æœ¬åœ° PyPI é•œåƒ |
| ç»“æœå½’æ¡£ (100MB) | 10-30 ç§’ | Server102 â†’ Server104 |

### G. å®¹é‡è§„åˆ’å»ºè®®

#### ç£ç›˜ç©ºé—´

| æœåŠ¡å™¨ | æœ€å°ç©ºé—´ | æ¨èç©ºé—´ | ä¸»è¦å ç”¨ |
|--------|----------|----------|----------|
| Server101 | 20GB | 100GB | é¡¹ç›®æºä»£ç  |
| Server102 | 50GB | 200GB | è™šæ‹Ÿç¯å¢ƒ + ä¸´æ—¶æ‰§è¡Œ |
| Server103 | 10GB | 20GB | ç³»ç»ŸæœåŠ¡ |
| Server104 | 100GB | 500GB | æ‰§è¡Œç»“æœå½’æ¡£ |

#### å¹¶å‘èƒ½åŠ›

- åŒæ—¶æ”¯æŒç”¨æˆ·æ•°ï¼š10-50 äºº
- åŒæ—¶æ‰§è¡Œä»»åŠ¡æ•°ï¼š5-10 ä¸ªï¼ˆå–å†³äº Server102 èµ„æºï¼‰
- è™šæ‹Ÿç¯å¢ƒæ•°é‡ï¼šæ¯ç”¨æˆ· 5-10 ä¸ª

#### ç½‘ç»œå¸¦å®½

- å†…ç½‘å¸¦å®½å»ºè®®ï¼šâ‰¥ 1Gbps
- é¡¹ç›®åŒæ­¥é€Ÿåº¦ï¼šçº¦ 100MB/s
- PyPI é•œåƒè®¿é—®ï¼šçº¦ 50MB/s

---

## æ€»ç»“

æœ¬æ•™ç¨‹è¯¦ç»†ä»‹ç»äº†åˆ†å¸ƒå¼ Python é¡¹ç›®ç®¡ç†ä¸æ‰§è¡Œå¹³å°çš„å®Œæ•´éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š

âœ… **ç³»ç»Ÿæ¶æ„**ï¼š4 å°æœåŠ¡å™¨çš„è§’è‰²åˆ†å·¥  
âœ… **éƒ¨ç½²æ­¥éª¤**ï¼šä»ç¯å¢ƒå‡†å¤‡åˆ°æœåŠ¡å¯åŠ¨çš„å®Œæ•´æµç¨‹  
âœ… **ä½¿ç”¨æŒ‡å—**ï¼šç”¨æˆ·åˆå§‹åŒ–ã€é¡¹ç›®æ‰§è¡Œã€ç»“æœæŸ¥çœ‹  
âœ… **æ•…éšœæ’æŸ¥**ï¼šå¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•  
âœ… **ç»´æŠ¤ç®¡ç†**ï¼šæ—¥å¸¸ç»´æŠ¤ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨åŠ å›º  

### å…³é”®è¦ç‚¹

1. **ç»Ÿä¸€ç®¡ç†**ï¼šé€šè¿‡ Server103 çš„ Web ç•Œé¢ç»Ÿä¸€æ“ä½œ
2. **è‡ªåŠ¨åŒ–æµç¨‹**ï¼šé¡¹ç›®åŒæ­¥ã€ä¾èµ–å®‰è£…ã€ç»“æœå½’æ¡£å…¨è‡ªåŠ¨
3. **æœ¬åœ°é•œåƒ**ï¼šä½¿ç”¨ PyPI é•œåƒåŠ é€Ÿä¾èµ–å®‰è£…
4. **ç»“æœè¿½æº¯**ï¼šæ¯æ¬¡æ‰§è¡Œéƒ½æœ‰å®Œæ•´çš„æ—¥å¿—å’Œé¡¹ç›®å¿«ç…§

### ä¸‹ä¸€æ­¥

- æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æœåŠ¡å™¨é…ç½®
- æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- é›†æˆç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
- ä¼˜åŒ–å¤§æ–‡ä»¶ä¼ è¾“æ€§èƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2026-01-15  
**ç»´æŠ¤è€…**ï¼šç³»ç»Ÿç®¡ç†å‘˜

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
